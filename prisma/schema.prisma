generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = "file:./dev.db"
}

model User {
  id                   String   @id @default(cuid())
  email                String   @unique
  name                 String?
  role                 String   @default("CLIENTE") // "ADMIN" | "METROLOGO" | "CLIENTE"
  passwordHash         String
  clienteId            String?
  cliente              Cliente? @relation(fields: [clienteId], references: [id])
  createdAt            DateTime @default(now())

  formatosComoMetrologo FormatoCalibracion[] @relation("MetrologoAFormato")
}

model Cliente {
  id       String  @id @default(cuid())
  nombre   String
  nit      String?
  ciudad   String?
  equipos  Equipo[]
  usuarios User[]
}

model Equipo {
  id         String  @id @default(cuid())
  clienteId  String
  cliente    Cliente @relation(fields: [clienteId], references: [id])
  tipo       String
  marca      String?
  modelo     String?
  serie      String?
  inventario String?
  formatos   FormatoCalibracion[]
}

model FormatoCalibracion {
  id             String  @id @default(cuid())
  equipoId       String
  equipo         Equipo  @relation(fields: [equipoId], references: [id])

  metrologoId    String
  metrologo      User    @relation("MetrologoAFormato", fields: [metrologoId], references: [id])

  fecha          DateTime
  lugar          String

  entradasJSON    String   // JSON serializado
  resultadosJSON  String   // JSON serializado

  pdfUrl         String?
  estado         String  @default("EN_PROCESO")
  createdAt      DateTime @default(now())
}
